{
  "$schema": "https://railway.app/schema.json",
  "build": {
    "builder": "dockerfile",
    "dockerfile": "Dockerfile"
  },
  "deploy": {
    "startCommand": "gunicorn parliament.wsgi:application -c gunicorn.conf.py",
    "restartPolicyMaxRetries": 3,
    "restartPolicyWindowSeconds": 60
  },
  "services": {
    "web": {
      "name": "TrueCivic Web",
      "description": "Django web application for Canadian parliamentary data",
      "serviceType": "web",
      "dockerfile": "Dockerfile",
      "rootDirectory": "/app",
      "environment": {
        "DJANGO_SETTINGS_MODULE": {
          "value": "parliament.settings",
          "description": "Django settings module"
        },
        "DATABASE_URL": {
          "reference": "${{Postgres.DATABASE_URL}}",
          "description": "PostgreSQL connection URL"
        },
        "REDIS_URL": {
          "reference": "${{Redis.REDIS_URL}}",
          "description": "Redis URL for caching and sessions"
        },
        "PYTHONUNBUFFERED": {
          "value": "1",
          "description": "Enable unbuffered Python output for logs"
        },
        "PORT": {
          "value": "8000",
          "description": "Port for the web application"
        },
        "QDRANT_URL": {
          "value": "",
          "description": "Internal URL for the Qdrant vector store"
        },
        "QDRANT_API_KEY": {
          "value": "",
          "description": "Optional API key for Qdrant if authentication is enabled"
        },
        "QDRANT_COLLECTION": {
          "value": "knowledge_chunks",
          "description": "Collection used for chat retrieval"
        },
        "QDRANT_TIMEOUT_SECONDS": {
          "value": "5",
          "description": "HTTP timeout used for Qdrant operations"
        }
      },
      "resources": {
        "cpu": "0.5",
        "memory": "1G",
        "maxConcurrency": 10
      },
      "networking": {
        "exposePort": true,
        "port": 8000
      }
    },
    "postgres": {
      "name": "PostgreSQL",
      "description": "Primary relational database for canonical data",
      "serviceType": "database",
      "image": "postgres:16-alpine",
      "environment": {
        "POSTGRES_DB": {
          "value": "parliament",
          "description": "Database name"
        },
        "POSTGRES_USER": {
          "value": "parliament",
          "description": "Database user"
        },
        "POSTGRES_PASSWORD": {
          "value": "${{Postgres.POSTGRES_PASSWORD}}",
          "description": "Database password"
        }
      },
      "resources": {
        "cpu": "1",
        "memory": "1G"
      }
    },
    "redis": {
      "name": "Redis",
      "description": "In-memory cache and session store",
      "serviceType": "database",
      "image": "redis:7-alpine",
      "resources": {
        "cpu": "0.25",
        "memory": "512M"
      }
    }
  }
}
